<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HotelDAO.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">HOTEL</a> &gt; <a href="index.source.html" class="el_package">es.deusto.spq.server.dao</a> &gt; <span class="el_source">HotelDAO.java</span></div><h1>HotelDAO.java</h1><pre class="source lang-java linenums">package es.deusto.spq.server.dao;

import java.sql.Connection;


import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import java.util.List;

import javax.jdo.JDOHelper;
import javax.jdo.PersistenceManager;
import javax.jdo.PersistenceManagerFactory;
import javax.jdo.Query;
import javax.jdo.Transaction;

import es.deusto.spq.server.*;


/**
 * DAO for Hotel class
 * @author maitanegarcia
 *
 */



<span class="nc" id="L30">public class HotelDAO  extends DataAccessObjectBase implements IDataAccessObject&lt;Hotel&gt; {</span>
<span class="nc" id="L31">	private static final HotelDAO INSTANCE = new HotelDAO();</span>
<span class="nc" id="L32">	 private static  PersistenceManagerFactory pmf = JDOHelper.getPersistenceManagerFactory(&quot;datanucleus.properties&quot;);</span>
	public static HotelDAO getInstance() {
<span class="nc" id="L34">		return INSTANCE;</span>
	}

	@Override
	public void save(Hotel object) {
		// TODO Auto-generated method stub
<span class="nc" id="L40">		super.saveObject(object);</span>
<span class="nc" id="L41">	}</span>
	/**
	 * Delete a hotel
	 */
	@Override
	public void delete(Hotel object) {
		// TODO Auto-generated method stub
<span class="nc" id="L48">		deleteObject(object);</span>
<span class="nc" id="L49">	}</span>
	/**
	 * Method that get a list of all the hotels
	 */
	@Override
	public List&lt;Hotel&gt; getAll() {
<span class="nc" id="L55">		PersistenceManager pm = pmf.getPersistenceManager();</span>
<span class="nc" id="L56">		Query&lt;Hotel&gt; q = pm.newQuery(Hotel.class);</span>
<span class="nc" id="L57">		List&lt;Hotel&gt; ListHotel = (List&lt;Hotel&gt;) q.executeList();</span>
<span class="nc" id="L58">		return ListHotel;</span>
		
	}
	/**
	 * Method that get a list Hotel by the name
	 * @param name
	 * @return a list of Hotel Names
	 */
	public List&lt;Hotel&gt; getbyName (String name) {
<span class="nc" id="L67">	    PersistenceManager pm = pmf.getPersistenceManager();</span>
<span class="nc" id="L68">	    Query&lt;Hotel&gt; q = pm.newQuery(Hotel.class,&quot;name == '&quot; + name.replace(&quot;'&quot;, &quot;''&quot;) + &quot;'&quot;);</span>
<span class="nc" id="L69">	    List&lt;Hotel&gt; resultList =  (List&lt;Hotel&gt;) q.execute();</span>
<span class="nc" id="L70">	    return resultList;</span>
	}
	
	/**
	 * Add a hotel
	 * @param hotel
	 */
    public void addHotel(Hotel hotel) {
<span class="nc" id="L78">        PersistenceManager pm = pmf.getPersistenceManager();</span>
<span class="nc" id="L79">        Transaction tx = pm.currentTransaction();</span>

        try {
<span class="nc" id="L82">            tx.begin();</span>
<span class="nc" id="L83">            pm.makePersistent(hotel);</span>
<span class="nc" id="L84">            tx.commit();</span>
<span class="nc" id="L85">        } catch (Exception e) {</span>
<span class="nc bnc" id="L86" title="All 2 branches missed.">            if (tx.isActive()) {</span>
<span class="nc" id="L87">                tx.rollback();</span>
            }
<span class="nc" id="L89">            e.printStackTrace();</span>
        } finally {
<span class="nc" id="L91">            pm.close();</span>
        }
<span class="nc" id="L93">    }</span>
 
    
    public List&lt;Hotel&gt; findHotelsByOwner(Guest owner) {
<span class="nc" id="L97">        PersistenceManager pm = pmf.getPersistenceManager();</span>
<span class="nc" id="L98">        Query&lt;Hotel&gt; q = pm.newQuery(Hotel.class, &quot;owner == :ownerParam&quot;);</span>
<span class="nc" id="L99">        q.setParameters(owner);</span>
<span class="nc" id="L100">        List&lt;Hotel&gt; resultList = (List&lt;Hotel&gt;) q.execute();</span>
<span class="nc" id="L101">        return resultList;</span>
    }
	/**
	 * Look for  if the name of the owner exits
	 * @param ownerName
	 * @return boolean , true o false
	 */
   
	public boolean ownerExists(String ownerName) {
<span class="nc" id="L110">	    PersistenceManager pm = pmf.getPersistenceManager();</span>
<span class="nc" id="L111">	    Query&lt;Guest&gt; q = pm.newQuery(Guest.class, &quot;name == '&quot; + ownerName.replace(&quot;'&quot;, &quot;''&quot;) + &quot;'&quot;);</span>
<span class="nc" id="L112">	    List&lt;Guest&gt; resultList =  (List&lt;Guest&gt;) q.execute();</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">	    return !resultList.isEmpty();</span>
	}

	

	@Override
	public Hotel find(String param) {
<span class="nc" id="L120">	    PersistenceManager pm = pmf.getPersistenceManager();  </span>
<span class="nc" id="L121">	    Query&lt;Hotel&gt; q = pm.newQuery(Hotel.class, &quot;name.toLowerCase().contains(:param)&quot;);  // Se crea una consulta JDO para la clase Hotel, filtrando el nombre </span>
<span class="nc" id="L122">	    q.setParameters(param.toLowerCase());  </span>
<span class="nc" id="L123">	    List&lt;Hotel&gt; resultList = (List&lt;Hotel&gt;) q.execute();  </span>
	    
<span class="nc bnc" id="L125" title="All 2 branches missed.">	    if (!resultList.isEmpty()) {</span>
<span class="nc" id="L126">	        return resultList.get(0);  // Devuelve el primer hotel encontrado</span>
	    } else {
<span class="nc" id="L128">	        return null;  // No se encontró ningún hotel</span>
	    }
	}
	 private void searchHotels(String query) {
	        // Configura la conexión a la base de datos (actualiza con tus propias credenciales y detalles de la base de datos)
<span class="nc" id="L133">	        String url = &quot;jdbc:mysql://loclhost:3306/HotelManagementDB&quot;;</span>
<span class="nc" id="L134">	        String username = &quot;spq&quot;;</span>
<span class="nc" id="L135">	        String password = &quot;spq&quot;;</span>

<span class="nc" id="L137">	        try ( Connection connection = DriverManager.getConnection(url, username, password)){</span>
<span class="nc" id="L138">	        	String sql = &quot;SELECT hotel FROM hoteles WHERE name LIKE '%&quot; + query + &quot;%'&quot;;</span>

	            
<span class="nc" id="L141">	            Statement statement = connection.createStatement();</span>
<span class="nc" id="L142">	            ResultSet resultSet = statement.executeQuery(sql);</span>

	            // Procesa los resultados de la consulta
<span class="nc" id="L145">	            StringBuilder resultBuilder = new StringBuilder();</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">	            while (resultSet.next()) {</span>
<span class="nc" id="L147">	                String hotelName = resultSet.getString(&quot;name&quot;);</span>
<span class="nc" id="L148">	                resultBuilder.append(&quot;- &quot;).append(hotelName).append(&quot;\n&quot;);</span>
<span class="nc" id="L149">	            }</span>

	            // Cierra la conexión y los recursos relacionados
<span class="nc" id="L152">	            resultSet.close();</span>
<span class="nc" id="L153">	            statement.close();</span>
<span class="nc" id="L154">	            connection.close();</span>

	            
<span class="nc" id="L157">	            String result = &quot;The query result is: &quot; + query;</span>
<span class="nc" id="L158">	        } catch (SQLException e) {</span>
<span class="nc" id="L159">	            e.printStackTrace();</span>
<span class="nc" id="L160">	        }</span>
<span class="nc" id="L161">	    }</span>
	 public void setPersistenceManagerFactory(PersistenceManagerFactory factory) {
<span class="nc" id="L163">	        pmf = factory;</span>
<span class="nc" id="L164">	    }</span>
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>